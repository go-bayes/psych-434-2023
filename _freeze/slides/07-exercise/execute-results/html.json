{
  "hash": "8652f15581b1b4526e2e439ae5d0a0ff",
  "result": {
    "markdown": "---\ntitle: \"Introduction to Causal Inference\"\nsubtitle: \"Data Exercise\"\nformat:\n  revealjs: \n    slide-number: true\n    smaller: false\n    scrollable: true\n    incremental: true\n    echo: true\n    chalkboard: true \n    buttons: false\n    preview-links: auto\n    theme: moon\n    embed-resources: false\n    code-fold: true\n    code-overflow: scroll\n    code-line-numbers: true\n    auto-stretch: true\n    html-math-method: katex\n    progress: true\n    bibliography: references.bib\nexecute:\n  warning: false\n---\n\n\n\n\n## load Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#|label: source\nsource(\"https://raw.githubusercontent.com/go-bayes/templates/main/functions/funs.R\")\n```\n:::\n\n\n\n\n## Load Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#|label: load-data\n#|eval: false\n######### PART 1: DATA EXCERCISE ##############\n\n# Create a folder called \"data\", in your Rstudio project. Download this file, add it to your the folder called \"data\" in your Rstudio project.\n# \"https://www.dropbox.com/s/vwqijg4ha17hbs1/nzavs_dat_synth_t10_t12?dl=0\"\n\n\n\n# This will read the synthetic data into Rstudio.  Note that the arrow package allows us to have lower memory demands in the storage and retrieval of data.\nnzavs_synth <-\n  arrow::read_parquet(here::here(\"data\", \"nzavs_dat_synth_t10_t12\"))\n```\n:::\n\n\n\n## Inspect\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## inspect colnames\ncolnames(nzavs_synth)\n\n## inspect data properties\nstr(nzavs_synth)\n```\n:::\n\n\n\n## Prepare data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaseline_vars = c(\n  \"edu\",\n  \"male\",\n  \"eth_cat\",\n  \"employed\",\n  \"gen_cohort\",\n  \"nz_dep2018\",\n  \"nzsei13\",\n  \"partner\",\n  \"parent\",\n  \"pol_orient\",\n  \"rural_gch2018\",\n  \"agreeableness\",\n  \"conscientiousness\",\n  \"extraversion\",\n  \"honesty_humility\",\n  \"openness\",\n  \"neuroticism\",\n  \"modesty\",\n  \"religion_identification_level\"\n)\n\n\n## Step 2, select the exposure variable.  This is the \"cause\"\n\nexposure_var = c(\"perfectionism\")\n\n\n## step 3. select the outcome variable.  These are the outcomes.\noutcome_vars_reflective = c(\"meaning_purpose\",\n                            \"meaning_sense\")\n\n\n# optional: select exclusion variables (this will not be necessary most of the time)\nexclude_vars = c(\"year_measured\")\n\n\n# the function \"create_wide_data\" should be in your environment. If not, make sure to run the first line of code in this script once more.  You may ignore the warnings.\n\nprep_reflective <-\n  create_wide_data(\n    dat_long = nzavs_synth,\n    #nzavs_synth,\n    baseline_vars = baseline_vars,\n    exposure_var = exposure_var,\n    outcome_vars = outcome_vars_reflective\n  )\n\n\n\n# check. Note that any column that is the exposure or an outcome is added to \"t0_\".  This ensures the strongest possible confounding control, as described by VanderWeele:\n# https://cdn1.sph.harvard.edu/wp-content/uploads/sites/603/2020/09/OutcomeWide_StatisticalScience.pdf\n\ncolnames(prep_reflective)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"t0_edu\"                           \"t0_male\"                         \n [3] \"t0_eth_cat\"                       \"t0_employed\"                     \n [5] \"t0_gen_cohort\"                    \"t0_nz_dep2018\"                   \n [7] \"t0_nzsei13\"                       \"t0_partner\"                      \n [9] \"t0_parent\"                        \"t0_pol_orient\"                   \n[11] \"t0_rural_gch2018\"                 \"t0_agreeableness\"                \n[13] \"t0_conscientiousness\"             \"t0_extraversion\"                 \n[15] \"t0_honesty_humility\"              \"t0_openness\"                     \n[17] \"t0_neuroticism\"                   \"t0_modesty\"                      \n[19] \"t0_religion_identification_level\" \"t0_perfectionism\"                \n[21] \"t0_meaning_purpose\"               \"t0_meaning_sense\"                \n[23] \"t1_perfectionism\"                 \"t2_meaning_purpose\"              \n[25] \"t2_meaning_sense\"                \n```\n:::\n\n```{.r .cell-code}\n# if the data is not working, you much run the code below to make the object in an object of the class dataframe.\n# prep_reflective <- as.data.frame(prep_reflective)\n```\n:::\n\n\n\n\n## create composite scores for constructs \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # should be loaded\n dt_ref <- prep_reflective |>\n  mutate(id = factor(1:nrow(prep_reflective))) |>\n  mutate(t1_perfectionism = round(t1_perfectionism)) |> # we create a three-level exposure to enable clear causal contrasts. We could also use a continous variable.\n  mutate(\n    t1_perfectionism_coarsen = cut(\n      t1_perfectionism,\n      breaks = c(1, 4, 5, 7),\n      include.lowest = TRUE,\n      include.highest = TRUE,\n      na.rm = TRUE,\n      right = FALSE\n    )\n  ) |>\n  mutate(\n    t0_eth_cat = as.factor(t0_eth_cat),\n    t0_rural_gch2018 = as.factor(t0_rural_gch2018),\n    t0_gen_cohort = as.factor(t0_gen_cohort)\n  ) |>\n  group_by(id) |>\n  dplyr::mutate(t2_meaning = mean(c(t2_meaning_purpose,\n                                    t2_meaning_sense),\n                                  na.rm = TRUE)) |>\n  ungroup() |>\n  # transform numeric variables into z scores (improves estimation)\n  dplyr::mutate(across(where(is.numeric), ~ scale(.x), .names = \"{col}_z\")) %>%\n  # select only factors and numeric values that are z-scores\n  select(id,\n         where(is.factor),\n         t1_perfectionism, # for comparison\n         ends_with(\"_z\"), ) |>\n  # tidy data frame so that the columns are ordered by time (useful for more complex models)\n  relocate(id, .before = starts_with(\"t1_\"))   |>\n  relocate(starts_with(\"t0_\"), .before = starts_with(\"t1_\"))  |>\n  relocate(starts_with(\"t2_\"), .after = starts_with(\"t1_\"))\n\n\n# inspect\nlevels(dt_ref$t1_perfectionism_coarsen)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"[1,4)\" \"[4,5)\" \"[5,7]\"\n```\n:::\n\n```{.r .cell-code}\n# rename levels\ndt_ref$t1_perfectionism_coarsen <-\n  factor(\n    dt_ref$t1_perfectionism_coarsen,\n    levels = c(\"[1,4)\", \"[4,5)\", \"[5,7]\"),\n    labels = c(\"low\", \"medium\", \"high\"),\n    ordered = TRUE\n  )\n```\n:::\n\n\n\n\n## save your dataframe for future use\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#|eval: false\n# make dataframe\ndt_ref = as.data.frame(dt_ref)\n\n# save data\nsaveRDS(dt_ref, here::here(\"data\", \"dt_ref\"))\n\n# read -- you may start here if you need to repeat the analysis\n\ndt_ref <- readRDS(here::here(\"data\", \"dt_ref\"))\n```\n:::\n\n\n\n\n## prepare models\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt_ref <- readRDS(here::here(\"data\", \"dt_ref\"))\n\n# needs to be data frame\ndt_ref = data.frame(dt_ref)\n\n# simplicity\ndf = dt_ref \n\n# this is the continuous exposure\nX = \"t1_perfectionism_z\"\n\n# this is a categorical exposure\nX_pc <- \"t1_perfectionism_coarsen\"\n\n\n# set our outcome variable:\nY = \"t2_meaning_z\" #note that we have created all numeric values into z-scores.  This will facilitate estimation and also interpretation. The outcome is expressed in standard deviation units\n\n\n# Get baseline names\nbaseline_vars_reflective_cont = dt_ref |>\n  dplyr::select(starts_with(\"t0\")) |> colnames()\n\n# See what we have created:  These are all the \"t0_\" variables.\n# baseline_vars_reflective_cont\n\n\n# to run these models our data need to be a dataframe (not a tibble or another kind of obect)\n# above we've made the data a dataframe, but lets repeat in case you skipped that steip\n\ndt_ref = as.data.frame(dt_ref)\n\n\n# create our formula string, this time for the categorical variable.\nformula_str_X <-\n  paste(Y,\n        \"~\",\n        X ,\n        \"*\",\n        \"(\",\n        paste(baseline_vars_reflective_cont, collapse = \"+\"),\n        \")\")\nformula_str_X\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"t2_meaning_z ~ t1_perfectionism_z * ( t0_male+t0_eth_cat+t0_gen_cohort+t0_rural_gch2018+t0_edu_z+t0_employed_z+t0_nz_dep2018_z+t0_nzsei13_z+t0_partner_z+t0_parent_z+t0_pol_orient_z+t0_agreeableness_z+t0_conscientiousness_z+t0_extraversion_z+t0_honesty_humility_z+t0_openness_z+t0_neuroticism_z+t0_modesty_z+t0_religion_identification_level_z+t0_perfectionism_z+t0_meaning_purpose_z+t0_meaning_sense_z )\"\n```\n:::\n\n```{.r .cell-code}\n## regression based control\n\n\n# fit model\nm1 <- glm(as.formula(formula_str_X),\n          # shortcut\n          #  weights = weights, # will use weights with propensity score models\n          family = \"gaussian\",\n          data = df)\n\n# we can look at the coefficients of this model, but again, it would be a mistake to interpret them\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = as.formula(formula_str_X), family = \"gaussian\", \n    data = df)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-4.3374  -0.3647   0.0675   0.4199   3.2766  \n\nCoefficients:\n                                                                Estimate\n(Intercept)                                                   -0.0458559\nt1_perfectionism_z                                            -0.1347193\nt0_maleNot_male                                                0.0632191\nt0_eth_catmāori                                                0.0341978\nt0_eth_catpacific                                             -0.0420690\nt0_eth_catasian                                                0.0224974\nt0_gen_cohort.L                                               -0.0203971\nt0_gen_cohort.Q                                                0.0224781\nt0_gen_cohort.C                                               -0.0005157\nt0_gen_cohort^4                                               -0.0234273\nt0_rural_gch2018medium_urban_accessibility                     0.0277126\nt0_rural_gch2018low_urban_accessibility                        0.0196446\nt0_rural_gch2018remote                                         0.0314218\nt0_rural_gch2018very_remote                                    0.0184033\nt0_edu_z                                                       0.0354573\nt0_employed_z                                                  0.0104852\nt0_nz_dep2018_z                                                0.0038250\nt0_nzsei13_z                                                   0.0186043\nt0_partner_z                                                   0.0186944\nt0_parent_z                                                    0.0304512\nt0_pol_orient_z                                                0.0268793\nt0_agreeableness_z                                             0.0251108\nt0_conscientiousness_z                                         0.0160022\nt0_extraversion_z                                              0.0443726\nt0_honesty_humility_z                                          0.0189023\nt0_openness_z                                                  0.0116959\nt0_neuroticism_z                                              -0.0440279\nt0_modesty_z                                                   0.0008530\nt0_religion_identification_level_z                             0.0601431\nt0_perfectionism_z                                             0.0136652\nt0_meaning_purpose_z                                           0.3689498\nt0_meaning_sense_z                                             0.2410291\nt1_perfectionism_z:t0_maleNot_male                             0.0331692\nt1_perfectionism_z:t0_eth_catmāori                             0.0094140\nt1_perfectionism_z:t0_eth_catpacific                          -0.0679774\nt1_perfectionism_z:t0_eth_catasian                            -0.0852596\nt1_perfectionism_z:t0_gen_cohort.L                            -0.0211112\nt1_perfectionism_z:t0_gen_cohort.Q                             0.1133846\nt1_perfectionism_z:t0_gen_cohort.C                            -0.0321318\nt1_perfectionism_z:t0_gen_cohort^4                             0.0033751\nt1_perfectionism_z:t0_rural_gch2018medium_urban_accessibility -0.0007409\nt1_perfectionism_z:t0_rural_gch2018low_urban_accessibility    -0.0087372\nt1_perfectionism_z:t0_rural_gch2018remote                     -0.0051989\nt1_perfectionism_z:t0_rural_gch2018very_remote                 0.0406504\nt1_perfectionism_z:t0_edu_z                                    0.0180683\nt1_perfectionism_z:t0_employed_z                               0.0110596\nt1_perfectionism_z:t0_nz_dep2018_z                            -0.0062207\nt1_perfectionism_z:t0_nzsei13_z                               -0.0011272\nt1_perfectionism_z:t0_partner_z                                0.0053248\nt1_perfectionism_z:t0_parent_z                                 0.0111114\nt1_perfectionism_z:t0_pol_orient_z                            -0.0003759\nt1_perfectionism_z:t0_agreeableness_z                         -0.0052810\nt1_perfectionism_z:t0_conscientiousness_z                     -0.0003144\nt1_perfectionism_z:t0_extraversion_z                          -0.0041967\nt1_perfectionism_z:t0_honesty_humility_z                       0.0026688\nt1_perfectionism_z:t0_openness_z                               0.0086363\nt1_perfectionism_z:t0_neuroticism_z                           -0.0145938\nt1_perfectionism_z:t0_modesty_z                               -0.0026194\nt1_perfectionism_z:t0_religion_identification_level_z          0.0086293\nt1_perfectionism_z:t0_perfectionism_z                          0.0212526\nt1_perfectionism_z:t0_meaning_purpose_z                        0.0231580\nt1_perfectionism_z:t0_meaning_sense_z                         -0.0017437\n                                                              Std. Error\n(Intercept)                                                    0.0206239\nt1_perfectionism_z                                             0.0217018\nt0_maleNot_male                                                0.0158872\nt0_eth_catmāori                                                0.0257156\nt0_eth_catpacific                                              0.0513832\nt0_eth_catasian                                                0.0401502\nt0_gen_cohort.L                                                0.0537594\nt0_gen_cohort.Q                                                0.0452441\nt0_gen_cohort.C                                                0.0287586\nt0_gen_cohort^4                                                0.0160948\nt0_rural_gch2018medium_urban_accessibility                     0.0185188\nt0_rural_gch2018low_urban_accessibility                        0.0226516\nt0_rural_gch2018remote                                         0.0338997\nt0_rural_gch2018very_remote                                    0.0697321\nt0_edu_z                                                       0.0085782\nt0_employed_z                                                  0.0073289\nt0_nz_dep2018_z                                                0.0072973\nt0_nzsei13_z                                                   0.0083108\nt0_partner_z                                                   0.0075420\nt0_parent_z                                                    0.0082115\nt0_pol_orient_z                                                0.0079719\nt0_agreeableness_z                                             0.0079531\nt0_conscientiousness_z                                         0.0075374\nt0_extraversion_z                                              0.0075663\nt0_honesty_humility_z                                          0.0080126\nt0_openness_z                                                  0.0076666\nt0_neuroticism_z                                               0.0084511\nt0_modesty_z                                                   0.0079318\nt0_religion_identification_level_z                             0.0075053\nt0_perfectionism_z                                             0.0106384\nt0_meaning_purpose_z                                           0.0097171\nt0_meaning_sense_z                                             0.0098484\nt1_perfectionism_z:t0_maleNot_male                             0.0159842\nt1_perfectionism_z:t0_eth_catmāori                             0.0248536\nt1_perfectionism_z:t0_eth_catpacific                           0.0513900\nt1_perfectionism_z:t0_eth_catasian                             0.0395309\nt1_perfectionism_z:t0_gen_cohort.L                             0.0531681\nt1_perfectionism_z:t0_gen_cohort.Q                             0.0443921\nt1_perfectionism_z:t0_gen_cohort.C                             0.0280822\nt1_perfectionism_z:t0_gen_cohort^4                             0.0158307\nt1_perfectionism_z:t0_rural_gch2018medium_urban_accessibility  0.0181669\nt1_perfectionism_z:t0_rural_gch2018low_urban_accessibility     0.0231386\nt1_perfectionism_z:t0_rural_gch2018remote                      0.0363971\nt1_perfectionism_z:t0_rural_gch2018very_remote                 0.0788117\nt1_perfectionism_z:t0_edu_z                                    0.0086251\nt1_perfectionism_z:t0_employed_z                               0.0070229\nt1_perfectionism_z:t0_nz_dep2018_z                             0.0072208\nt1_perfectionism_z:t0_nzsei13_z                                0.0082785\nt1_perfectionism_z:t0_partner_z                                0.0072999\nt1_perfectionism_z:t0_parent_z                                 0.0082109\nt1_perfectionism_z:t0_pol_orient_z                             0.0078204\nt1_perfectionism_z:t0_agreeableness_z                          0.0075244\nt1_perfectionism_z:t0_conscientiousness_z                      0.0071301\nt1_perfectionism_z:t0_extraversion_z                           0.0073804\nt1_perfectionism_z:t0_honesty_humility_z                       0.0078333\nt1_perfectionism_z:t0_openness_z                               0.0074053\nt1_perfectionism_z:t0_neuroticism_z                            0.0082842\nt1_perfectionism_z:t0_modesty_z                                0.0079651\nt1_perfectionism_z:t0_religion_identification_level_z          0.0074253\nt1_perfectionism_z:t0_perfectionism_z                          0.0081526\nt1_perfectionism_z:t0_meaning_purpose_z                        0.0090046\nt1_perfectionism_z:t0_meaning_sense_z                          0.0086903\n                                                              t value Pr(>|t|)\n(Intercept)                                                    -2.223  0.02621\nt1_perfectionism_z                                             -6.208 5.59e-10\nt0_maleNot_male                                                 3.979 6.96e-05\nt0_eth_catmāori                                                 1.330  0.18360\nt0_eth_catpacific                                              -0.819  0.41296\nt0_eth_catasian                                                 0.560  0.57527\nt0_gen_cohort.L                                                -0.379  0.70439\nt0_gen_cohort.Q                                                 0.497  0.61933\nt0_gen_cohort.C                                                -0.018  0.98569\nt0_gen_cohort^4                                                -1.456  0.14554\nt0_rural_gch2018medium_urban_accessibility                      1.496  0.13457\nt0_rural_gch2018low_urban_accessibility                         0.867  0.38583\nt0_rural_gch2018remote                                          0.927  0.35400\nt0_rural_gch2018very_remote                                     0.264  0.79185\nt0_edu_z                                                        4.133 3.60e-05\nt0_employed_z                                                   1.431  0.15256\nt0_nz_dep2018_z                                                 0.524  0.60018\nt0_nzsei13_z                                                    2.239  0.02521\nt0_partner_z                                                    2.479  0.01320\nt0_parent_z                                                     3.708  0.00021\nt0_pol_orient_z                                                 3.372  0.00075\nt0_agreeableness_z                                              3.157  0.00160\nt0_conscientiousness_z                                          2.123  0.03378\nt0_extraversion_z                                               5.865 4.65e-09\nt0_honesty_humility_z                                           2.359  0.01834\nt0_openness_z                                                   1.526  0.12715\nt0_neuroticism_z                                               -5.210 1.93e-07\nt0_modesty_z                                                    0.108  0.91436\nt0_religion_identification_level_z                              8.013 1.24e-15\nt0_perfectionism_z                                              1.285  0.19899\nt0_meaning_purpose_z                                           37.969  < 2e-16\nt0_meaning_sense_z                                             24.474  < 2e-16\nt1_perfectionism_z:t0_maleNot_male                              2.075  0.03800\nt1_perfectionism_z:t0_eth_catmāori                              0.379  0.70486\nt1_perfectionism_z:t0_eth_catpacific                           -1.323  0.18594\nt1_perfectionism_z:t0_eth_catasian                             -2.157  0.03105\nt1_perfectionism_z:t0_gen_cohort.L                             -0.397  0.69133\nt1_perfectionism_z:t0_gen_cohort.Q                              2.554  0.01066\nt1_perfectionism_z:t0_gen_cohort.C                             -1.144  0.25257\nt1_perfectionism_z:t0_gen_cohort^4                              0.213  0.83117\nt1_perfectionism_z:t0_rural_gch2018medium_urban_accessibility  -0.041  0.96747\nt1_perfectionism_z:t0_rural_gch2018low_urban_accessibility     -0.378  0.70573\nt1_perfectionism_z:t0_rural_gch2018remote                      -0.143  0.88642\nt1_perfectionism_z:t0_rural_gch2018very_remote                  0.516  0.60601\nt1_perfectionism_z:t0_edu_z                                     2.095  0.03621\nt1_perfectionism_z:t0_employed_z                                1.575  0.11533\nt1_perfectionism_z:t0_nz_dep2018_z                             -0.861  0.38899\nt1_perfectionism_z:t0_nzsei13_z                                -0.136  0.89169\nt1_perfectionism_z:t0_partner_z                                 0.729  0.46575\nt1_perfectionism_z:t0_parent_z                                  1.353  0.17601\nt1_perfectionism_z:t0_pol_orient_z                             -0.048  0.96167\nt1_perfectionism_z:t0_agreeableness_z                          -0.702  0.48279\nt1_perfectionism_z:t0_conscientiousness_z                      -0.044  0.96482\nt1_perfectionism_z:t0_extraversion_z                           -0.569  0.56963\nt1_perfectionism_z:t0_honesty_humility_z                        0.341  0.73334\nt1_perfectionism_z:t0_openness_z                                1.166  0.24355\nt1_perfectionism_z:t0_neuroticism_z                            -1.762  0.07816\nt1_perfectionism_z:t0_modesty_z                                -0.329  0.74226\nt1_perfectionism_z:t0_religion_identification_level_z           1.162  0.24520\nt1_perfectionism_z:t0_perfectionism_z                           2.607  0.00915\nt1_perfectionism_z:t0_meaning_purpose_z                         2.572  0.01013\nt1_perfectionism_z:t0_meaning_sense_z                          -0.201  0.84098\n                                                                 \n(Intercept)                                                   *  \nt1_perfectionism_z                                            ***\nt0_maleNot_male                                               ***\nt0_eth_catmāori                                                  \nt0_eth_catpacific                                                \nt0_eth_catasian                                                  \nt0_gen_cohort.L                                                  \nt0_gen_cohort.Q                                                  \nt0_gen_cohort.C                                                  \nt0_gen_cohort^4                                                  \nt0_rural_gch2018medium_urban_accessibility                       \nt0_rural_gch2018low_urban_accessibility                          \nt0_rural_gch2018remote                                           \nt0_rural_gch2018very_remote                                      \nt0_edu_z                                                      ***\nt0_employed_z                                                    \nt0_nz_dep2018_z                                                  \nt0_nzsei13_z                                                  *  \nt0_partner_z                                                  *  \nt0_parent_z                                                   ***\nt0_pol_orient_z                                               ***\nt0_agreeableness_z                                            ** \nt0_conscientiousness_z                                        *  \nt0_extraversion_z                                             ***\nt0_honesty_humility_z                                         *  \nt0_openness_z                                                    \nt0_neuroticism_z                                              ***\nt0_modesty_z                                                     \nt0_religion_identification_level_z                            ***\nt0_perfectionism_z                                               \nt0_meaning_purpose_z                                          ***\nt0_meaning_sense_z                                            ***\nt1_perfectionism_z:t0_maleNot_male                            *  \nt1_perfectionism_z:t0_eth_catmāori                               \nt1_perfectionism_z:t0_eth_catpacific                             \nt1_perfectionism_z:t0_eth_catasian                            *  \nt1_perfectionism_z:t0_gen_cohort.L                               \nt1_perfectionism_z:t0_gen_cohort.Q                            *  \nt1_perfectionism_z:t0_gen_cohort.C                               \nt1_perfectionism_z:t0_gen_cohort^4                               \nt1_perfectionism_z:t0_rural_gch2018medium_urban_accessibility    \nt1_perfectionism_z:t0_rural_gch2018low_urban_accessibility       \nt1_perfectionism_z:t0_rural_gch2018remote                        \nt1_perfectionism_z:t0_rural_gch2018very_remote                   \nt1_perfectionism_z:t0_edu_z                                   *  \nt1_perfectionism_z:t0_employed_z                                 \nt1_perfectionism_z:t0_nz_dep2018_z                               \nt1_perfectionism_z:t0_nzsei13_z                                  \nt1_perfectionism_z:t0_partner_z                                  \nt1_perfectionism_z:t0_parent_z                                   \nt1_perfectionism_z:t0_pol_orient_z                               \nt1_perfectionism_z:t0_agreeableness_z                            \nt1_perfectionism_z:t0_conscientiousness_z                        \nt1_perfectionism_z:t0_extraversion_z                             \nt1_perfectionism_z:t0_honesty_humility_z                         \nt1_perfectionism_z:t0_openness_z                                 \nt1_perfectionism_z:t0_neuroticism_z                           .  \nt1_perfectionism_z:t0_modesty_z                                  \nt1_perfectionism_z:t0_religion_identification_level_z            \nt1_perfectionism_z:t0_perfectionism_z                         ** \nt1_perfectionism_z:t0_meaning_purpose_z                       *  \nt1_perfectionism_z:t0_meaning_sense_z                            \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 0.479121)\n\n    Null deviance: 9999.0  on 9999  degrees of freedom\nResidual deviance: 4761.5  on 9938  degrees of freedom\nAIC: 21085\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n:::\n\n\n\n\n\n\n# simulate coefficients for the continuous exposure\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(clarify)\nnsims = 200\nsim_model_r <- sim(m1, n = nsims)\n\n\n# set to number of cores on your machine, e.g.\ncores = 2\n\n# simulate effect as modified\nsim_estimand_r <- sim_ame(sim_model_r,\n                          var = X,\n                          cl = cores,\n                          verbose = FALSE)\n\n\n# this is the difference in expectations between everyone in the population being subject to a one standard deviation increase in perfectionism\n# and everyone being subject to an average level of perfectionism.\n\n\n# Estimate  2.5 % 97.5 %\n#   dY/d(t1_perfectionism_z)   -0.160 -0.178 -0.140\n\nsummary(sim_estimand_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         Estimate  2.5 % 97.5 %\ndY/d(t1_perfectionism_z)   -0.160 -0.182 -0.142\n```\n:::\n:::\n\n\n\n## Coarsened variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create our formula string:\nformula_str_X_pc <-\n  paste(Y,\n        \"~\",\n        X_pc ,\n        \"*\",\n        \"(\",\n        paste(baseline_vars_reflective_cont, collapse = \"+\"),\n        \")\")\n\nformula_str_X_pc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"t2_meaning_z ~ t1_perfectionism_coarsen * ( t0_male+t0_eth_cat+t0_gen_cohort+t0_rural_gch2018+t0_edu_z+t0_employed_z+t0_nz_dep2018_z+t0_nzsei13_z+t0_partner_z+t0_parent_z+t0_pol_orient_z+t0_agreeableness_z+t0_conscientiousness_z+t0_extraversion_z+t0_honesty_humility_z+t0_openness_z+t0_neuroticism_z+t0_modesty_z+t0_religion_identification_level_z+t0_perfectionism_z+t0_meaning_purpose_z+t0_meaning_sense_z )\"\n```\n:::\n\n```{.r .cell-code}\n# fit model\nm2 <- glm(as.formula(formula_str_X_pc),\n          # shortcut\n          #  weights = weights, # will use weights with propensity score models\n          family = \"gaussian\",\n          data = df)\n\n# we can look at the coefficients of this model, but again it would be a mistake to interpret them\n\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = as.formula(formula_str_X_pc), family = \"gaussian\", \n    data = df)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-4.1848  -0.3670   0.0660   0.4251   3.2601  \n\nCoefficients:\n                                                                        Estimate\n(Intercept)                                                           -0.1226132\nt1_perfectionism_coarsen.L                                            -0.1470404\nt1_perfectionism_coarsen.Q                                             0.0968493\nt0_maleNot_male                                                        0.0953799\nt0_eth_catmāori                                                        0.0330656\nt0_eth_catpacific                                                     -0.0797194\nt0_eth_catasian                                                       -0.0450017\nt0_gen_cohort.L                                                       -0.0638088\nt0_gen_cohort.Q                                                        0.0783060\nt0_gen_cohort.C                                                       -0.0171482\nt0_gen_cohort^4                                                       -0.0209400\nt0_rural_gch2018medium_urban_accessibility                             0.0356611\nt0_rural_gch2018low_urban_accessibility                                0.0112271\nt0_rural_gch2018remote                                                 0.0206451\nt0_rural_gch2018very_remote                                            0.0708426\nt0_edu_z                                                               0.0436332\nt0_employed_z                                                          0.0170529\nt0_nz_dep2018_z                                                       -0.0018689\nt0_nzsei13_z                                                           0.0204286\nt0_partner_z                                                           0.0165503\nt0_parent_z                                                            0.0377576\nt0_pol_orient_z                                                        0.0228034\nt0_agreeableness_z                                                     0.0180559\nt0_conscientiousness_z                                                 0.0192677\nt0_extraversion_z                                                      0.0450764\nt0_honesty_humility_z                                                  0.0222787\nt0_openness_z                                                          0.0159350\nt0_neuroticism_z                                                      -0.0602859\nt0_modesty_z                                                          -0.0035097\nt0_religion_identification_level_z                                     0.0604881\nt0_perfectionism_z                                                     0.0008418\nt0_meaning_purpose_z                                                   0.3868685\nt0_meaning_sense_z                                                     0.2434801\nt1_perfectionism_coarsen.L:t0_maleNot_male                             0.0620947\nt1_perfectionism_coarsen.Q:t0_maleNot_male                            -0.0431561\nt1_perfectionism_coarsen.L:t0_eth_catmāori                             0.0669463\nt1_perfectionism_coarsen.Q:t0_eth_catmāori                             0.1235800\nt1_perfectionism_coarsen.L:t0_eth_catpacific                          -0.0718211\nt1_perfectionism_coarsen.Q:t0_eth_catpacific                           0.0856952\nt1_perfectionism_coarsen.L:t0_eth_catasian                            -0.1551102\nt1_perfectionism_coarsen.Q:t0_eth_catasian                             0.0883442\nt1_perfectionism_coarsen.L:t0_gen_cohort.L                            -0.0306497\nt1_perfectionism_coarsen.Q:t0_gen_cohort.L                             0.1516702\nt1_perfectionism_coarsen.L:t0_gen_cohort.Q                             0.1958547\nt1_perfectionism_coarsen.Q:t0_gen_cohort.Q                             0.0454657\nt1_perfectionism_coarsen.L:t0_gen_cohort.C                            -0.0322455\nt1_perfectionism_coarsen.Q:t0_gen_cohort.C                             0.0440922\nt1_perfectionism_coarsen.L:t0_gen_cohort^4                             0.0173854\nt1_perfectionism_coarsen.Q:t0_gen_cohort^4                             0.0131898\nt1_perfectionism_coarsen.L:t0_rural_gch2018medium_urban_accessibility  0.0090066\nt1_perfectionism_coarsen.Q:t0_rural_gch2018medium_urban_accessibility  0.0005206\nt1_perfectionism_coarsen.L:t0_rural_gch2018low_urban_accessibility    -0.0464747\nt1_perfectionism_coarsen.Q:t0_rural_gch2018low_urban_accessibility    -0.0419324\nt1_perfectionism_coarsen.L:t0_rural_gch2018remote                     -0.0830230\nt1_perfectionism_coarsen.Q:t0_rural_gch2018remote                     -0.1385026\nt1_perfectionism_coarsen.L:t0_rural_gch2018very_remote                 0.0971420\nt1_perfectionism_coarsen.Q:t0_rural_gch2018very_remote                -0.0499774\nt1_perfectionism_coarsen.L:t0_edu_z                                    0.0286493\nt1_perfectionism_coarsen.Q:t0_edu_z                                   -0.0028539\nt1_perfectionism_coarsen.L:t0_employed_z                               0.0252432\nt1_perfectionism_coarsen.Q:t0_employed_z                               0.0091128\nt1_perfectionism_coarsen.L:t0_nz_dep2018_z                            -0.0093324\nt1_perfectionism_coarsen.Q:t0_nz_dep2018_z                             0.0005713\nt1_perfectionism_coarsen.L:t0_nzsei13_z                                0.0009809\nt1_perfectionism_coarsen.Q:t0_nzsei13_z                                0.0032192\nt1_perfectionism_coarsen.L:t0_partner_z                                0.0012847\nt1_perfectionism_coarsen.Q:t0_partner_z                                0.0115548\nt1_perfectionism_coarsen.L:t0_parent_z                                 0.0270801\nt1_perfectionism_coarsen.Q:t0_parent_z                                 0.0090702\nt1_perfectionism_coarsen.L:t0_pol_orient_z                            -0.0006814\nt1_perfectionism_coarsen.Q:t0_pol_orient_z                             0.0172947\nt1_perfectionism_coarsen.L:t0_agreeableness_z                         -0.0189019\nt1_perfectionism_coarsen.Q:t0_agreeableness_z                          0.0024354\nt1_perfectionism_coarsen.L:t0_conscientiousness_z                     -0.0126309\nt1_perfectionism_coarsen.Q:t0_conscientiousness_z                     -0.0194902\nt1_perfectionism_coarsen.L:t0_extraversion_z                          -0.0002204\nt1_perfectionism_coarsen.Q:t0_extraversion_z                           0.0165607\nt1_perfectionism_coarsen.L:t0_honesty_humility_z                      -0.0027931\nt1_perfectionism_coarsen.Q:t0_honesty_humility_z                      -0.0140992\nt1_perfectionism_coarsen.L:t0_openness_z                               0.0065241\nt1_perfectionism_coarsen.Q:t0_openness_z                              -0.0126349\nt1_perfectionism_coarsen.L:t0_neuroticism_z                           -0.0234255\nt1_perfectionism_coarsen.Q:t0_neuroticism_z                            0.0062206\nt1_perfectionism_coarsen.L:t0_modesty_z                               -0.0108579\nt1_perfectionism_coarsen.Q:t0_modesty_z                                0.0147372\nt1_perfectionism_coarsen.L:t0_religion_identification_level_z          0.0227283\nt1_perfectionism_coarsen.Q:t0_religion_identification_level_z          0.0279009\nt1_perfectionism_coarsen.L:t0_perfectionism_z                          0.0320759\nt1_perfectionism_coarsen.Q:t0_perfectionism_z                         -0.0455083\nt1_perfectionism_coarsen.L:t0_meaning_purpose_z                        0.0411158\nt1_perfectionism_coarsen.Q:t0_meaning_purpose_z                        0.0056432\nt1_perfectionism_coarsen.L:t0_meaning_sense_z                         -0.0091829\nt1_perfectionism_coarsen.Q:t0_meaning_sense_z                         -0.0111806\n                                                                      Std. Error\n(Intercept)                                                            0.0254701\nt1_perfectionism_coarsen.L                                             0.0431872\nt1_perfectionism_coarsen.Q                                             0.0450248\nt0_maleNot_male                                                        0.0192675\nt0_eth_catmāori                                                        0.0299149\nt0_eth_catpacific                                                      0.0608525\nt0_eth_catasian                                                        0.0426782\nt0_gen_cohort.L                                                        0.0603945\nt0_gen_cohort.Q                                                        0.0506044\nt0_gen_cohort.C                                                        0.0321417\nt0_gen_cohort^4                                                        0.0184486\nt0_rural_gch2018medium_urban_accessibility                             0.0227806\nt0_rural_gch2018low_urban_accessibility                                0.0280264\nt0_rural_gch2018remote                                                 0.0427166\nt0_rural_gch2018very_remote                                            0.0932044\nt0_edu_z                                                               0.0105185\nt0_employed_z                                                          0.0086131\nt0_nz_dep2018_z                                                        0.0086805\nt0_nzsei13_z                                                           0.0100606\nt0_partner_z                                                           0.0085931\nt0_parent_z                                                            0.0097982\nt0_pol_orient_z                                                        0.0097893\nt0_agreeableness_z                                                     0.0092234\nt0_conscientiousness_z                                                 0.0085661\nt0_extraversion_z                                                      0.0091048\nt0_honesty_humility_z                                                  0.0096794\nt0_openness_z                                                          0.0092394\nt0_neuroticism_z                                                       0.0099422\nt0_modesty_z                                                           0.0094387\nt0_religion_identification_level_z                                     0.0092116\nt0_perfectionism_z                                                     0.0113879\nt0_meaning_purpose_z                                                   0.0105537\nt0_meaning_sense_z                                                     0.0099679\nt1_perfectionism_coarsen.L:t0_maleNot_male                             0.0314355\nt1_perfectionism_coarsen.Q:t0_maleNot_male                             0.0352027\nt1_perfectionism_coarsen.L:t0_eth_catmāori                             0.0484912\nt1_perfectionism_coarsen.Q:t0_eth_catmāori                             0.0549365\nt1_perfectionism_coarsen.L:t0_eth_catpacific                           0.1061646\nt1_perfectionism_coarsen.Q:t0_eth_catpacific                           0.1046290\nt1_perfectionism_coarsen.L:t0_eth_catasian                             0.0698406\nt1_perfectionism_coarsen.Q:t0_eth_catasian                             0.0777872\nt1_perfectionism_coarsen.L:t0_gen_cohort.L                             0.1029227\nt1_perfectionism_coarsen.Q:t0_gen_cohort.L                             0.1062634\nt1_perfectionism_coarsen.L:t0_gen_cohort.Q                             0.0861450\nt1_perfectionism_coarsen.Q:t0_gen_cohort.Q                             0.0891283\nt1_perfectionism_coarsen.L:t0_gen_cohort.C                             0.0545987\nt1_perfectionism_coarsen.Q:t0_gen_cohort.C                             0.0567232\nt1_perfectionism_coarsen.L:t0_gen_cohort^4                             0.0306661\nt1_perfectionism_coarsen.Q:t0_gen_cohort^4                             0.0331920\nt1_perfectionism_coarsen.L:t0_rural_gch2018medium_urban_accessibility  0.0367803\nt1_perfectionism_coarsen.Q:t0_rural_gch2018medium_urban_accessibility  0.0419635\nt1_perfectionism_coarsen.L:t0_rural_gch2018low_urban_accessibility     0.0461386\nt1_perfectionism_coarsen.Q:t0_rural_gch2018low_urban_accessibility     0.0508341\nt1_perfectionism_coarsen.L:t0_rural_gch2018remote                      0.0743191\nt1_perfectionism_coarsen.Q:t0_rural_gch2018remote                      0.0736540\nt1_perfectionism_coarsen.L:t0_rural_gch2018very_remote                 0.1618903\nt1_perfectionism_coarsen.Q:t0_rural_gch2018very_remote                 0.1609781\nt1_perfectionism_coarsen.L:t0_edu_z                                    0.0169322\nt1_perfectionism_coarsen.Q:t0_edu_z                                    0.0194200\nt1_perfectionism_coarsen.L:t0_employed_z                               0.0140222\nt1_perfectionism_coarsen.Q:t0_employed_z                               0.0157635\nt1_perfectionism_coarsen.L:t0_nz_dep2018_z                             0.0140633\nt1_perfectionism_coarsen.Q:t0_nz_dep2018_z                             0.0159476\nt1_perfectionism_coarsen.L:t0_nzsei13_z                                0.0163164\nt1_perfectionism_coarsen.Q:t0_nzsei13_z                                0.0184681\nt1_perfectionism_coarsen.L:t0_partner_z                                0.0140428\nt1_perfectionism_coarsen.Q:t0_partner_z                                0.0156797\nt1_perfectionism_coarsen.L:t0_parent_z                                 0.0160940\nt1_perfectionism_coarsen.Q:t0_parent_z                                 0.0178048\nt1_perfectionism_coarsen.L:t0_pol_orient_z                             0.0158645\nt1_perfectionism_coarsen.Q:t0_pol_orient_z                             0.0179807\nt1_perfectionism_coarsen.L:t0_agreeableness_z                          0.0144998\nt1_perfectionism_coarsen.Q:t0_agreeableness_z                          0.0173259\nt1_perfectionism_coarsen.L:t0_conscientiousness_z                      0.0135816\nt1_perfectionism_coarsen.Q:t0_conscientiousness_z                      0.0159942\nt1_perfectionism_coarsen.L:t0_extraversion_z                           0.0146683\nt1_perfectionism_coarsen.Q:t0_extraversion_z                           0.0167994\nt1_perfectionism_coarsen.L:t0_honesty_humility_z                       0.0155358\nt1_perfectionism_coarsen.Q:t0_honesty_humility_z                       0.0179105\nt1_perfectionism_coarsen.L:t0_openness_z                               0.0147235\nt1_perfectionism_coarsen.Q:t0_openness_z                               0.0171878\nt1_perfectionism_coarsen.L:t0_neuroticism_z                            0.0160470\nt1_perfectionism_coarsen.Q:t0_neuroticism_z                            0.0183189\nt1_perfectionism_coarsen.L:t0_modesty_z                                0.0153804\nt1_perfectionism_coarsen.Q:t0_modesty_z                                0.0172620\nt1_perfectionism_coarsen.L:t0_religion_identification_level_z          0.0149222\nt1_perfectionism_coarsen.Q:t0_religion_identification_level_z          0.0169249\nt1_perfectionism_coarsen.L:t0_perfectionism_z                          0.0178542\nt1_perfectionism_coarsen.Q:t0_perfectionism_z                          0.0214321\nt1_perfectionism_coarsen.L:t0_meaning_purpose_z                        0.0171386\nt1_perfectionism_coarsen.Q:t0_meaning_purpose_z                        0.0193535\nt1_perfectionism_coarsen.L:t0_meaning_sense_z                          0.0158506\nt1_perfectionism_coarsen.Q:t0_meaning_sense_z                          0.0185719\n                                                                      t value\n(Intercept)                                                            -4.814\nt1_perfectionism_coarsen.L                                             -3.405\nt1_perfectionism_coarsen.Q                                              2.151\nt0_maleNot_male                                                         4.950\nt0_eth_catmāori                                                         1.105\nt0_eth_catpacific                                                      -1.310\nt0_eth_catasian                                                        -1.054\nt0_gen_cohort.L                                                        -1.057\nt0_gen_cohort.Q                                                         1.547\nt0_gen_cohort.C                                                        -0.534\nt0_gen_cohort^4                                                        -1.135\nt0_rural_gch2018medium_urban_accessibility                              1.565\nt0_rural_gch2018low_urban_accessibility                                 0.401\nt0_rural_gch2018remote                                                  0.483\nt0_rural_gch2018very_remote                                             0.760\nt0_edu_z                                                                4.148\nt0_employed_z                                                           1.980\nt0_nz_dep2018_z                                                        -0.215\nt0_nzsei13_z                                                            2.031\nt0_partner_z                                                            1.926\nt0_parent_z                                                             3.854\nt0_pol_orient_z                                                         2.329\nt0_agreeableness_z                                                      1.958\nt0_conscientiousness_z                                                  2.249\nt0_extraversion_z                                                       4.951\nt0_honesty_humility_z                                                   2.302\nt0_openness_z                                                           1.725\nt0_neuroticism_z                                                       -6.064\nt0_modesty_z                                                           -0.372\nt0_religion_identification_level_z                                      6.566\nt0_perfectionism_z                                                      0.074\nt0_meaning_purpose_z                                                   36.657\nt0_meaning_sense_z                                                     24.426\nt1_perfectionism_coarsen.L:t0_maleNot_male                              1.975\nt1_perfectionism_coarsen.Q:t0_maleNot_male                             -1.226\nt1_perfectionism_coarsen.L:t0_eth_catmāori                              1.381\nt1_perfectionism_coarsen.Q:t0_eth_catmāori                              2.250\nt1_perfectionism_coarsen.L:t0_eth_catpacific                           -0.677\nt1_perfectionism_coarsen.Q:t0_eth_catpacific                            0.819\nt1_perfectionism_coarsen.L:t0_eth_catasian                             -2.221\nt1_perfectionism_coarsen.Q:t0_eth_catasian                              1.136\nt1_perfectionism_coarsen.L:t0_gen_cohort.L                             -0.298\nt1_perfectionism_coarsen.Q:t0_gen_cohort.L                              1.427\nt1_perfectionism_coarsen.L:t0_gen_cohort.Q                              2.274\nt1_perfectionism_coarsen.Q:t0_gen_cohort.Q                              0.510\nt1_perfectionism_coarsen.L:t0_gen_cohort.C                             -0.591\nt1_perfectionism_coarsen.Q:t0_gen_cohort.C                              0.777\nt1_perfectionism_coarsen.L:t0_gen_cohort^4                              0.567\nt1_perfectionism_coarsen.Q:t0_gen_cohort^4                              0.397\nt1_perfectionism_coarsen.L:t0_rural_gch2018medium_urban_accessibility   0.245\nt1_perfectionism_coarsen.Q:t0_rural_gch2018medium_urban_accessibility   0.012\nt1_perfectionism_coarsen.L:t0_rural_gch2018low_urban_accessibility     -1.007\nt1_perfectionism_coarsen.Q:t0_rural_gch2018low_urban_accessibility     -0.825\nt1_perfectionism_coarsen.L:t0_rural_gch2018remote                      -1.117\nt1_perfectionism_coarsen.Q:t0_rural_gch2018remote                      -1.880\nt1_perfectionism_coarsen.L:t0_rural_gch2018very_remote                  0.600\nt1_perfectionism_coarsen.Q:t0_rural_gch2018very_remote                 -0.310\nt1_perfectionism_coarsen.L:t0_edu_z                                     1.692\nt1_perfectionism_coarsen.Q:t0_edu_z                                    -0.147\nt1_perfectionism_coarsen.L:t0_employed_z                                1.800\nt1_perfectionism_coarsen.Q:t0_employed_z                                0.578\nt1_perfectionism_coarsen.L:t0_nz_dep2018_z                             -0.664\nt1_perfectionism_coarsen.Q:t0_nz_dep2018_z                              0.036\nt1_perfectionism_coarsen.L:t0_nzsei13_z                                 0.060\nt1_perfectionism_coarsen.Q:t0_nzsei13_z                                 0.174\nt1_perfectionism_coarsen.L:t0_partner_z                                 0.091\nt1_perfectionism_coarsen.Q:t0_partner_z                                 0.737\nt1_perfectionism_coarsen.L:t0_parent_z                                  1.683\nt1_perfectionism_coarsen.Q:t0_parent_z                                  0.509\nt1_perfectionism_coarsen.L:t0_pol_orient_z                             -0.043\nt1_perfectionism_coarsen.Q:t0_pol_orient_z                              0.962\nt1_perfectionism_coarsen.L:t0_agreeableness_z                          -1.304\nt1_perfectionism_coarsen.Q:t0_agreeableness_z                           0.141\nt1_perfectionism_coarsen.L:t0_conscientiousness_z                      -0.930\nt1_perfectionism_coarsen.Q:t0_conscientiousness_z                      -1.219\nt1_perfectionism_coarsen.L:t0_extraversion_z                           -0.015\nt1_perfectionism_coarsen.Q:t0_extraversion_z                            0.986\nt1_perfectionism_coarsen.L:t0_honesty_humility_z                       -0.180\nt1_perfectionism_coarsen.Q:t0_honesty_humility_z                       -0.787\nt1_perfectionism_coarsen.L:t0_openness_z                                0.443\nt1_perfectionism_coarsen.Q:t0_openness_z                               -0.735\nt1_perfectionism_coarsen.L:t0_neuroticism_z                            -1.460\nt1_perfectionism_coarsen.Q:t0_neuroticism_z                             0.340\nt1_perfectionism_coarsen.L:t0_modesty_z                                -0.706\nt1_perfectionism_coarsen.Q:t0_modesty_z                                 0.854\nt1_perfectionism_coarsen.L:t0_religion_identification_level_z           1.523\nt1_perfectionism_coarsen.Q:t0_religion_identification_level_z           1.649\nt1_perfectionism_coarsen.L:t0_perfectionism_z                           1.797\nt1_perfectionism_coarsen.Q:t0_perfectionism_z                          -2.123\nt1_perfectionism_coarsen.L:t0_meaning_purpose_z                         2.399\nt1_perfectionism_coarsen.Q:t0_meaning_purpose_z                         0.292\nt1_perfectionism_coarsen.L:t0_meaning_sense_z                          -0.579\nt1_perfectionism_coarsen.Q:t0_meaning_sense_z                          -0.602\n                                                                      Pr(>|t|)\n(Intercept)                                                           1.50e-06\nt1_perfectionism_coarsen.L                                            0.000665\nt1_perfectionism_coarsen.Q                                            0.031498\nt0_maleNot_male                                                       7.53e-07\nt0_eth_catmāori                                                       0.269047\nt0_eth_catpacific                                                     0.190212\nt0_eth_catasian                                                       0.291706\nt0_gen_cohort.L                                                       0.290751\nt0_gen_cohort.Q                                                       0.121795\nt0_gen_cohort.C                                                       0.593687\nt0_gen_cohort^4                                                       0.256384\nt0_rural_gch2018medium_urban_accessibility                            0.117517\nt0_rural_gch2018low_urban_accessibility                               0.688730\nt0_rural_gch2018remote                                                0.628891\nt0_rural_gch2018very_remote                                           0.447226\nt0_edu_z                                                              3.38e-05\nt0_employed_z                                                         0.047744\nt0_nz_dep2018_z                                                       0.829534\nt0_nzsei13_z                                                          0.042327\nt0_partner_z                                                          0.054135\nt0_parent_z                                                           0.000117\nt0_pol_orient_z                                                       0.019857\nt0_agreeableness_z                                                    0.050304\nt0_conscientiousness_z                                                0.024516\nt0_extraversion_z                                                     7.51e-07\nt0_honesty_humility_z                                                 0.021375\nt0_openness_z                                                         0.084617\nt0_neuroticism_z                                                      1.38e-09\nt0_modesty_z                                                          0.710020\nt0_religion_identification_level_z                                    5.41e-11\nt0_perfectionism_z                                                    0.941074\nt0_meaning_purpose_z                                                   < 2e-16\nt0_meaning_sense_z                                                     < 2e-16\nt1_perfectionism_coarsen.L:t0_maleNot_male                            0.048261\nt1_perfectionism_coarsen.Q:t0_maleNot_male                            0.220253\nt1_perfectionism_coarsen.L:t0_eth_catmāori                            0.167437\nt1_perfectionism_coarsen.Q:t0_eth_catmāori                            0.024502\nt1_perfectionism_coarsen.L:t0_eth_catpacific                          0.498734\nt1_perfectionism_coarsen.Q:t0_eth_catpacific                          0.412784\nt1_perfectionism_coarsen.L:t0_eth_catasian                            0.026379\nt1_perfectionism_coarsen.Q:t0_eth_catasian                            0.256103\nt1_perfectionism_coarsen.L:t0_gen_cohort.L                            0.765867\nt1_perfectionism_coarsen.Q:t0_gen_cohort.L                            0.153524\nt1_perfectionism_coarsen.L:t0_gen_cohort.Q                            0.023014\nt1_perfectionism_coarsen.Q:t0_gen_cohort.Q                            0.609982\nt1_perfectionism_coarsen.L:t0_gen_cohort.C                            0.554808\nt1_perfectionism_coarsen.Q:t0_gen_cohort.C                            0.436987\nt1_perfectionism_coarsen.L:t0_gen_cohort^4                            0.570776\nt1_perfectionism_coarsen.Q:t0_gen_cohort^4                            0.691096\nt1_perfectionism_coarsen.L:t0_rural_gch2018medium_urban_accessibility 0.806558\nt1_perfectionism_coarsen.Q:t0_rural_gch2018medium_urban_accessibility 0.990102\nt1_perfectionism_coarsen.L:t0_rural_gch2018low_urban_accessibility    0.313823\nt1_perfectionism_coarsen.Q:t0_rural_gch2018low_urban_accessibility    0.409455\nt1_perfectionism_coarsen.L:t0_rural_gch2018remote                     0.263972\nt1_perfectionism_coarsen.Q:t0_rural_gch2018remote                     0.060076\nt1_perfectionism_coarsen.L:t0_rural_gch2018very_remote                0.548488\nt1_perfectionism_coarsen.Q:t0_rural_gch2018very_remote                0.756217\nt1_perfectionism_coarsen.L:t0_edu_z                                   0.090678\nt1_perfectionism_coarsen.Q:t0_edu_z                                   0.883169\nt1_perfectionism_coarsen.L:t0_employed_z                              0.071854\nt1_perfectionism_coarsen.Q:t0_employed_z                              0.563212\nt1_perfectionism_coarsen.L:t0_nz_dep2018_z                            0.506962\nt1_perfectionism_coarsen.Q:t0_nz_dep2018_z                            0.971423\nt1_perfectionism_coarsen.L:t0_nzsei13_z                               0.952065\nt1_perfectionism_coarsen.Q:t0_nzsei13_z                               0.861624\nt1_perfectionism_coarsen.L:t0_partner_z                               0.927110\nt1_perfectionism_coarsen.Q:t0_partner_z                               0.461182\nt1_perfectionism_coarsen.L:t0_parent_z                                0.092480\nt1_perfectionism_coarsen.Q:t0_parent_z                                0.610469\nt1_perfectionism_coarsen.L:t0_pol_orient_z                            0.965741\nt1_perfectionism_coarsen.Q:t0_pol_orient_z                            0.336148\nt1_perfectionism_coarsen.L:t0_agreeableness_z                         0.192401\nt1_perfectionism_coarsen.Q:t0_agreeableness_z                         0.888218\nt1_perfectionism_coarsen.L:t0_conscientiousness_z                     0.352392\nt1_perfectionism_coarsen.Q:t0_conscientiousness_z                     0.223033\nt1_perfectionism_coarsen.L:t0_extraversion_z                          0.988010\nt1_perfectionism_coarsen.Q:t0_extraversion_z                          0.324261\nt1_perfectionism_coarsen.L:t0_honesty_humility_z                      0.857325\nt1_perfectionism_coarsen.Q:t0_honesty_humility_z                      0.431181\nt1_perfectionism_coarsen.L:t0_openness_z                              0.657697\nt1_perfectionism_coarsen.Q:t0_openness_z                              0.462292\nt1_perfectionism_coarsen.L:t0_neuroticism_z                           0.144377\nt1_perfectionism_coarsen.Q:t0_neuroticism_z                           0.734185\nt1_perfectionism_coarsen.L:t0_modesty_z                               0.480232\nt1_perfectionism_coarsen.Q:t0_modesty_z                               0.393271\nt1_perfectionism_coarsen.L:t0_religion_identification_level_z         0.127762\nt1_perfectionism_coarsen.Q:t0_religion_identification_level_z         0.099281\nt1_perfectionism_coarsen.L:t0_perfectionism_z                         0.072437\nt1_perfectionism_coarsen.Q:t0_perfectionism_z                         0.033747\nt1_perfectionism_coarsen.L:t0_meaning_purpose_z                       0.016457\nt1_perfectionism_coarsen.Q:t0_meaning_purpose_z                       0.770611\nt1_perfectionism_coarsen.L:t0_meaning_sense_z                         0.562371\nt1_perfectionism_coarsen.Q:t0_meaning_sense_z                         0.547176\n                                                                         \n(Intercept)                                                           ***\nt1_perfectionism_coarsen.L                                            ***\nt1_perfectionism_coarsen.Q                                            *  \nt0_maleNot_male                                                       ***\nt0_eth_catmāori                                                          \nt0_eth_catpacific                                                        \nt0_eth_catasian                                                          \nt0_gen_cohort.L                                                          \nt0_gen_cohort.Q                                                          \nt0_gen_cohort.C                                                          \nt0_gen_cohort^4                                                          \nt0_rural_gch2018medium_urban_accessibility                               \nt0_rural_gch2018low_urban_accessibility                                  \nt0_rural_gch2018remote                                                   \nt0_rural_gch2018very_remote                                              \nt0_edu_z                                                              ***\nt0_employed_z                                                         *  \nt0_nz_dep2018_z                                                          \nt0_nzsei13_z                                                          *  \nt0_partner_z                                                          .  \nt0_parent_z                                                           ***\nt0_pol_orient_z                                                       *  \nt0_agreeableness_z                                                    .  \nt0_conscientiousness_z                                                *  \nt0_extraversion_z                                                     ***\nt0_honesty_humility_z                                                 *  \nt0_openness_z                                                         .  \nt0_neuroticism_z                                                      ***\nt0_modesty_z                                                             \nt0_religion_identification_level_z                                    ***\nt0_perfectionism_z                                                       \nt0_meaning_purpose_z                                                  ***\nt0_meaning_sense_z                                                    ***\nt1_perfectionism_coarsen.L:t0_maleNot_male                            *  \nt1_perfectionism_coarsen.Q:t0_maleNot_male                               \nt1_perfectionism_coarsen.L:t0_eth_catmāori                               \nt1_perfectionism_coarsen.Q:t0_eth_catmāori                            *  \nt1_perfectionism_coarsen.L:t0_eth_catpacific                             \nt1_perfectionism_coarsen.Q:t0_eth_catpacific                             \nt1_perfectionism_coarsen.L:t0_eth_catasian                            *  \nt1_perfectionism_coarsen.Q:t0_eth_catasian                               \nt1_perfectionism_coarsen.L:t0_gen_cohort.L                               \nt1_perfectionism_coarsen.Q:t0_gen_cohort.L                               \nt1_perfectionism_coarsen.L:t0_gen_cohort.Q                            *  \nt1_perfectionism_coarsen.Q:t0_gen_cohort.Q                               \nt1_perfectionism_coarsen.L:t0_gen_cohort.C                               \nt1_perfectionism_coarsen.Q:t0_gen_cohort.C                               \nt1_perfectionism_coarsen.L:t0_gen_cohort^4                               \nt1_perfectionism_coarsen.Q:t0_gen_cohort^4                               \nt1_perfectionism_coarsen.L:t0_rural_gch2018medium_urban_accessibility    \nt1_perfectionism_coarsen.Q:t0_rural_gch2018medium_urban_accessibility    \nt1_perfectionism_coarsen.L:t0_rural_gch2018low_urban_accessibility       \nt1_perfectionism_coarsen.Q:t0_rural_gch2018low_urban_accessibility       \nt1_perfectionism_coarsen.L:t0_rural_gch2018remote                        \nt1_perfectionism_coarsen.Q:t0_rural_gch2018remote                     .  \nt1_perfectionism_coarsen.L:t0_rural_gch2018very_remote                   \nt1_perfectionism_coarsen.Q:t0_rural_gch2018very_remote                   \nt1_perfectionism_coarsen.L:t0_edu_z                                   .  \nt1_perfectionism_coarsen.Q:t0_edu_z                                      \nt1_perfectionism_coarsen.L:t0_employed_z                              .  \nt1_perfectionism_coarsen.Q:t0_employed_z                                 \nt1_perfectionism_coarsen.L:t0_nz_dep2018_z                               \nt1_perfectionism_coarsen.Q:t0_nz_dep2018_z                               \nt1_perfectionism_coarsen.L:t0_nzsei13_z                                  \nt1_perfectionism_coarsen.Q:t0_nzsei13_z                                  \nt1_perfectionism_coarsen.L:t0_partner_z                                  \nt1_perfectionism_coarsen.Q:t0_partner_z                                  \nt1_perfectionism_coarsen.L:t0_parent_z                                .  \nt1_perfectionism_coarsen.Q:t0_parent_z                                   \nt1_perfectionism_coarsen.L:t0_pol_orient_z                               \nt1_perfectionism_coarsen.Q:t0_pol_orient_z                               \nt1_perfectionism_coarsen.L:t0_agreeableness_z                            \nt1_perfectionism_coarsen.Q:t0_agreeableness_z                            \nt1_perfectionism_coarsen.L:t0_conscientiousness_z                        \nt1_perfectionism_coarsen.Q:t0_conscientiousness_z                        \nt1_perfectionism_coarsen.L:t0_extraversion_z                             \nt1_perfectionism_coarsen.Q:t0_extraversion_z                             \nt1_perfectionism_coarsen.L:t0_honesty_humility_z                         \nt1_perfectionism_coarsen.Q:t0_honesty_humility_z                         \nt1_perfectionism_coarsen.L:t0_openness_z                                 \nt1_perfectionism_coarsen.Q:t0_openness_z                                 \nt1_perfectionism_coarsen.L:t0_neuroticism_z                              \nt1_perfectionism_coarsen.Q:t0_neuroticism_z                              \nt1_perfectionism_coarsen.L:t0_modesty_z                                  \nt1_perfectionism_coarsen.Q:t0_modesty_z                                  \nt1_perfectionism_coarsen.L:t0_religion_identification_level_z            \nt1_perfectionism_coarsen.Q:t0_religion_identification_level_z         .  \nt1_perfectionism_coarsen.L:t0_perfectionism_z                         .  \nt1_perfectionism_coarsen.Q:t0_perfectionism_z                         *  \nt1_perfectionism_coarsen.L:t0_meaning_purpose_z                       *  \nt1_perfectionism_coarsen.Q:t0_meaning_purpose_z                          \nt1_perfectionism_coarsen.L:t0_meaning_sense_z                            \nt1_perfectionism_coarsen.Q:t0_meaning_sense_z                            \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 0.4840355)\n\n    Null deviance: 9999.0  on 9999  degrees of freedom\nResidual deviance: 4795.3  on 9907  degrees of freedom\nAIC: 21217\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n:::\n\n\n\n##  simulate coefficients\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(clarify)\nnsims = 200\nsim_model_r2 <- sim(m2, n = nsims)\n\n\n# set to number of cores on your machine, e.g.\ncores = 4\n\n# simulate effect as modified\nsim_estimand_r2 <- sim_ame(sim_model_r2,\n                           var = X_pc,\n                           cl = cores,\n                           verbose = FALSE)\n\n\n\n\nsummary(sim_estimand_r2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate   2.5 %  97.5 %\nE[Y(low)]      0.0747  0.0548  0.0916\nE[Y(medium)]  -0.1220 -0.1617 -0.0849\nE[Y(high)]    -0.1872 -0.2440 -0.1236\n```\n:::\n:::\n\n\n\n##  Suppose we want to contrast everyone being assigned to medium with everyone being assigned to high.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_estimand_r2_focal <-\n  transform(sim_estimand_r2, RD = `E[Y(low)]` - `E[Y(high)]`)\n\n\n# RD describes the causal contrast on the risk difference scale.\nsummary(sim_estimand_r2_focal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Estimate   2.5 %  97.5 %\nE[Y(low)]      0.0747  0.0548  0.0916\nE[Y(medium)]  -0.1220 -0.1617 -0.0849\nE[Y(high)]    -0.1872 -0.2440 -0.1236\nRD             0.2619  0.1987  0.3161\n```\n:::\n\n```{.r .cell-code}\n# The ATE for the effect of moving from low to high is .26 a standard deviation unit in meaning.  What this means is that the expected loss of meaning from perfectionism is about a quarter standard deviation\n\n\n# > summary(sim_estimand_r2)\n# Estimate   2.5 %  97.5 %\n# E[Y(low)]      0.0747  0.0519  0.0950\n# E[Y(medium)]  -0.1220 -0.1534 -0.0788\n# E[Y(high)]    -0.1872 -0.2408 -0.1360\n\n\n# We interpret these contrasts as the expected effects were everyone \"low\" verses everyone assigned \"medium\" versus everyone assigned \"high\"\n```\n:::\n\n\n\n\n\n## CAUSAL GRAPHS\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# also load the ggdag package\nif(!require(ggdag)){\n  # Install the package if it is not already installed\n  install.packages(\"ggdag\")\n}\n# load the ggdag package\nlibrary(ggdag)\n```\n:::\n\n\n\n\n\n\n\n## Problem 1: bilingualism on cognitive abilities\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Using the DAG below as a starting point, create a DAG in R using the `ggdag` package that represents the causal relationships among bilingualism (B), cognitive abilities (C), and socioeconomic status (S).\n\n\n\ndag1 <- dagify(C ~ B + S,\n               B ~ S,\n               coords = list(x = c(S = 1, B = 2, C = 3),\n                             y = c(S = 1, B = 2, C = 1)),\n               exposure = \"B\",\n               outcome = \"C\")\n\n# inspect\ntidy_dagitty(dag1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A DAG with 3 nodes and 3 edges\n#\n# Exposure: B\n# Outcome: C\n#\n# A tibble: 4 × 8\n  name      x     y direction to     xend  yend circular\n  <chr> <int> <int> <fct>     <chr> <int> <int> <lgl>   \n1 B         2     2 ->        C         3     1 FALSE   \n2 C         3     1 <NA>      <NA>     NA    NA FALSE   \n3 S         1     1 ->        B         2     2 FALSE   \n4 S         1     1 ->        C         3     1 FALSE   \n```\n:::\n\n```{.r .cell-code}\ndag1_t <- tidy_dagitty(dag1)\n\n# # plot\n# ggdag(dag1_t)\n# \n# # view\n# ggdag::ggdag_paths(dag1_t)\n# \n# # inspect\n# ggdag_parents(dag1_t, \"B\")\n\n# find adjustment set: adjusting for S is sufficient to control for confounding (on the model's assumptions)\nggdag_adjustment_set(dag1_t)\n```\n\n::: {.cell-output-display}\n![](07-exercise_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "07-exercise_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}